# 

## 一.终端的概念

在unix的系统中，用户通过终端登陆系统后得到一个shell进程，这个终端成为shell进程的控制终端（Controlling Terminal）,进程中，控制终端是保存在PCB
中的信息，而fork会赋值PCB中的信息，因此有shell进程启动的其他进程的控制终端也是这个终端。


## 二.进程组
```
进程组，也称之为作业，**代表一个或多个进程的集合**。

当父进程创建子进程时，默认子进程与父进程属于同一个进程组，进程组ID为第一个进程的ID（组长进程）。

可以使用kill -SIGKILL -进程组ID将进程组内的进程全部杀死。

组长进程可以创建进程组，创建进程组中的进程，然后终止。只要进程组中有一个进程存在，进程组就存在，与组长进程是否终止无关。

进程生存周期：进程组创建  ----- 最后一个进程终止或转移到其他进程组。

一个进程可以为自己或子进程创建进程组ID。

```

## 三.会话的概念与API

会话是一个或多个进程组的集合

```
1. 一个会话可以有一个控制终端，这通常是终端设备或伪终端设备。
2. 建立与控制终端连接的会话首进程被称为控制进程。
3. 一个会话中的进程组可以被分为一个前台进程组以及一个或多个后台进程组。
4. 如果终端接口检测到断开连接，则将挂断信号发送至控制进程（会话首进程）。

```

### 3.2创建会话的注意事项：

1. 调用进程不能是进程组组长，该进程变成新会话首进程（session header）。
2. 该调用进程是组长进程，则出错返回。
3. 该进程成为一个新进程组的组长进程。
4. 需要root权限（ubuntu不需要）。
5. 新会话丢弃原有的控制终端，该会话没有控制终端。
6. 建立新会话时，先调用fork，父进程终止，子进程调用setsid(设置会话id)。



### 3.3API函数

pid_t getsid(pid_t pid); 查看进程所属会话ID
pid_t setsid(pid_t pid); 新建会话ID

## 四.守护进程（重点）

### 1. 介绍：
守护进程（Daemon Process），也就是常说的Daemon进程、精灵进程。是Linux中的后台服务进程。它是一个生存周期较长的进程，通常独立于控制终端并且周期性的执行某种任务或等待处理某些发生的事件。一般采用以d结尾的名字。

守护进程是一个特殊的孤儿进程。这种进程脱离终端。以避免控制终端的影响：例如关闭守护进程。

### 2.守护进程实现步骤
```
a. 创建子进程，父进程必须退出（必须）
   所有工作在子进程中进行形式上脱离了控制终端
b. 在子进程中创建新会话（必须）
   setsid函数
   使子进程完全独立出来，脱离控制
c. 改变当前目录为根目录（不是必须）
   chdir()函数
   防止占用可以卸载的文件系统
   也可以换成其他路径
d. 重设文件权限掩码（不是必须）
   umask()函数
   防止继承的文件创建屏蔽字拒绝某些权限
   增加守护进程的灵活性
e. 关闭文件描述符（非必须）
   继承的打开文件不会用到，浪费系统资源，无法卸载
f. 开始执行守护进程核心工作（必须）
   守护进程退出处理程序模型
```


