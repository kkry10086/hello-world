# 第十章

## 10.1引言

信号是Linux进程间通信的最古老的方式，信号是软件中断。它是在软件层次上对中断机制的一种
模拟是一种异步通信的方式，信号可以导致一个正在运行的异步进程终端，转而处理某一个突发事件。

## 10.2 信号的特点：
1.简单
2.不能携带大量信息
3.满足某个特定条件才发送

信号可以直接进行用户空间进程和内核空间进程的交互，内核进程可以用它来通知用户空间进程发生了哪些系统事件。
一个完整的信号周期包括三个部分：信号的产生、信号在进程中的注册、信号在进程中的注销，执行信号处理函数。

## 10.3信号的编号

kill -l可以看到那些信号编号与名称。


## 10.4信号四要素

1.编号
2.名称
3.时间
4.默认处理动作

man 7 signal可以查看功能

## 10.5信号的状态

### 1).产生

```
a.当用户按某些终端按键时，将产生信号。
  终端上按ctrl+c通常产生中断信号SIGINT
  终端上按ctrl+\通常产生中断信号SIGQUIT
  
b.硬件异常将产生信号
  除数为0，无效的内存访问等，这些情况通常由硬件检测到，并通知内核，然后内核产生适当的信号发送给相应的进程
  
c.软件异常将产生信号
  当检测到某种软件条件已发生如：定时器alarm，并将其通知有关进程时，产生信号。

d.调用系统函数如：kill,raise,abort等讲发送信号
  注意接受信号和发送信号进程的所有者必须相同，或者发送信号进程的所有者必须是超级用户。
  
e.运行kill/killall命令将发送信号
  此程序实际上是使用kill函数库来发送信号。

```

### 2).未决状态：没有被处理

### 3.)递达状态：信号被处理了


## 10.6阻塞信号集和未决信号集

信号的实现手段导致信号有很强的延时性，但对于用户非常短，不易察觉。
Linux内核的进程控制块PCB是一个结构体，也包含了信号相关的信息，主要指阻塞信号集和未决信号集。

### 10.6.1阻塞信号集（信号屏蔽字）
  将某些信号加入集合，对它们设置屏蔽，当屏蔽x信号后，再收到该信号，该信号的处理将退后（处理发生在解除屏蔽幕后）。

### 10.6.2未决信号集
  信号产生，未决信号集中描述该信号的位 立刻 转为1，表示信号处于未决状态。当信号被处理，对应位变为0，这一时刻非常短。
  该信号的产生由于某些原因（主要是阻塞）不能抵达，这类信号的集合称之为未决信号。在屏蔽解除前信号一直处于未决状态。

## 10.7信号产生函数

1.kill函数
2.raise函数
3.abort函数
4.alarm函数
5.settimer函数



## 10.8 信号集

1.sigprocmask函数：
阻塞信号集

2.sigpending函数
未决信号集


## 10.9 信号捕捉函数

1.signal（不推荐）

signal在不同的发行版可能使用方式不同，可能会导致程序出现问题。

2.sigaction（推荐）

sigaction有统一的标准，所以建议使用

3.sigqueue（了解）


## 10.10 不可重入，可重入函数

1. 不可重入函数 概述：
不同任务调用这个函数可能修改其他任务调用这个函数的数据，从而导致不可预料的后果，这样的函数是不安全的函数，也叫不可重入函数。

2. 满足以下特点的大多就是不可重入函数：
  a. 函数体使用了静态的数据结构
  b. 函数体内调用了动态分配或释放的函数（malloc、new、free、delete）
  c. 函数体内调用了标准的I/O函数（printf、cout、cin、scanf_s）
  
  
3. 可重入函数概述：
就是可以被不同任务调用，且不用担心数据是否会出错的函数

4. 保证函数可重入的方法：
  a. 在函数体内尽量使用局部变量
  b.对于要使用的全局变量要加以保护（如采取关中断，信号量等互斥方法），这样构成的函数一定是可重入函数。
  

## 10.11 SIGCHLD信号

1. SIGCHLD信号产生的条件
```
  a.子进程终止时
  b.子进程接收到SIGSTOP信号停止时
  c.子进程处在停止态，接收到SIGCONT后唤醒时
  
```

2. 如何避免僵尸进程
```
1)最简单的方式，父进程通过wait和waitpid等待子进程结束，但是这会导致父进程挂起；

2)如果父进程要处理的事务很多，不能够挂起，通过signal和sigaction函数认为处理信号SIGCHLD，只要有子进程退出，自动调用给定好的函数，因为子进程结束后，父进程会收到SIGCHLD，可以在其回调函数里调用wait和waitpid函数。

```

