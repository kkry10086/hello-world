# 18.1什么是登陆档

简单的说：记录系统活动信息的几个文件。
换句话说：记录系统在什么时候由哪个程序做了什么样的行为时，发生了何种的事件等等。

## 18.1.1 Centos 登陆档建议说明

要知道，我们的linux主机在后台之下有相当多的daemons同时在工作，这些工作中的程序总是会显示一些讯息，这些讯息最终都会被记录到登陆文件中。也就是说，记录这些系统的重要讯息就是登陆文件的工作。

### a.登陆档的重要性

#### 解决系统方面的错误：

#### 解决网络服务的问题：

我们在做完了某些网络服务的设定后，却一直无法顺利启动该服务。由于网络服务的各种问题通常都会被写入特别的登陆档，所以可以查询该登陆档。

#### 过往事件记录本：

我们系统发生什么都会被记录，假设你的电脑被入侵了，那么就可以查询记录档，相关的信息。而且入侵我们系统的主机，可以通过登陆档可以了解我们的信息，同时我们也可以追溯对方的主机。

### b.Linux常见的登陆档名
登陆文件的权限通常是设定为仅有root能够读取而已。

**1./var/log/boot.log:**
**开机的时候系统核心回去侦测与启动硬件，接下来开始各种核心支持的功能启动等**。这些流程都会记录在/var/log/boot.log里面。不过这个文件只会存在这次开机启动的信息，前次开机的信息并不会被保留下来。

**2./var/log/cron:**
例行性工作排程，crontab排程有没有被实际进行，进行过程有没有发生错误，/etc/crontab是否撰写正确。都记录在这个文件里面。

**3.var/log/dmesg:**
记录系统**在开机的时候核心侦测过程所产生的各项信息**。由于Centos默认将开机时核心的硬件侦测过程取消显示，因此额外将数据记录一份在这个文件中。

**4./var/log/lastlog:**
可以记录**系统上面所有的账号最近一次登入系统时的相关信息**。lastlog指令就是利用这个文件的记录信息来显示的。

**5./var/log/maillog或/var/log/mail/*:**
记录邮件的往来信息，其实**主要是记录postfix(SMTP协议提供者)与dovecot(POP3协议提供者)所产生的讯息。**SMTP是发信所使用的通讯协议，POP3则是收信使用的通信协议。postfix与dovecot则分别是两套达成通讯协议的软件。

**6./var/log/messages:**
**这个文件相当重要，几乎系统发生的错误讯息(或者是重要讯息)都会记录在这个文件中；如果系统发生莫名的错误时，这个文件是一定要查阅的登陆档之一。**

**7./var/log/secure:**
**基本上，只要牵涉到【需要输入账号密码】的软件，那么当登入时（不管登入正确或错误）都会被记录在此文件中国。包括系统的login程序、图形接口登入所使用的gdm程序、su，sudo等程序、还有网络联机的ssh，telnet等程序，登入信息都会被记载在这里。**

**8./var/log/wtmp,/var/log/faillog:**
这两个文件可以记录争取登入系统者的账户信息（wtmp）与错误登入时做使用的账户信息（faillog）。last就是读取wtmp来现实的，这对于追踪一般账号者的使用行为很有帮助。

**9./var/log/httpd/*,/var/log/samba/*:**
不同的网络服务会使用他们自己的登陆文件来记录他们自己产生的各项讯息。上述的目录内则是个别服务所制定的登陆档。

当然这是主要的登陆档，这时在Centos的情况，其他的发行版就不一定了。

### c.登陆档所需相关服务（daemon）与程序

**登陆档如何产生：**
基本上有两种方式：
1.有软件开发商自行定义写入的登陆档与相关格式，例如WWW软件apache就是这样处理的。

2.有Linux distribution提供的登陆档管理服务来统一管理。你只要将讯息丢给这个服务后，它就会自己分门别类的将各种讯息放置到相关的登陆档中。Centos提供rssylog.service这个服务来统一管理登陆档。

**注意：**

如果我们任凭登陆文件持续记录的话，由于系统产生的信息天天都有，那么你的登陆文件的容量将会长大到非常大。如果你的登陆文件容量太大时，可能会导致大文件读写效率不佳的问题。所以，我们需要对登陆档备份与更新。我们可以透过logrotate（登陆档轮替）来自动化处理文件容量与更新的问题。

所谓的logrotate基本上，就是将旧的登陆档更改名称，然后建立一个空的登陆档。如此依赖，新的登陆文件该重新开始记录，然后只要将旧的登陆档留一阵子。就可以达到将登陆档【轮转】的目的。此外，如果旧的记录保存了一段时间没有问题，那么就可以让系统自动地将它删掉，释放硬

**总结一下：**
针对登陆档文件所需的功能，我们需要的服务与程序有：
。systemd-journald.service：最主要的讯息收受者，有systemd提供。
。rssylog.service: 主要登陆系统与网络等服务的讯息。
。logrotate: 主要在进行登陆文件的轮替功能。

### d.CentOs7.x 使用systemd提供的journalctl 日志管理

CentOs 7除了保有既有 syslog.service之外，其实最上游还使用了systemd自己的登陆文件
日志管理功能。他使用的是systemd-journald.service这个服务来支持的。基本上，系统有systemd所管理，按所有经由sytemd启动的服务，如果再启动或结束的过程中发生一些问题或者是正常的讯息，都会将该讯息有systemd-journald.service以二进程的方式记录下来，之后再将这个讯息发送给rsyslog.service作进一步的记录。
