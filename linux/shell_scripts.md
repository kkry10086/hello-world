learning shell scripts

12.1什么是shell脚本
  shell脚本就是利用shell的功能所写的一个程序.这个程序是使用纯文本文件,将一些shell
  语法与命令写在里面,搭配正则表达式,管道命令,与数据流重定向等功能,以达到我们所想要
  处理的目的.

   12.1.1为什么学习shell脚本:
   .自动化管理的重要根据
   .跟踪与管理系统的重要工作
   .简单入侵检测功能
   .连续命令单一化
    集合一些在命令行的连续命令,将它写入脚本文件当中,而由直接执行脚本来启动一连串的命
    令行输入.
   .简单的数据处理
   .跨平台支持与学习历程较短
    不过shell的程序的运行速度远远比不上其他语言的程序.shell脚本用在系统管理上面是
    很好用的一项工具,但是用在处理大量的数值运算上,就不够好了,原因是shell的脚本的
    速度比较慢,使用的cpu资源较多,会造成主机资源的分配不良.


    12.1.2 第一个脚本的编写与执行
    shell脚本的编写需要注意下面的事项:
    1.命令是从上而下,从左到右的分析与运行
    2.命令的执行就如同第四章内提到的,命令,选项,参数间的多个空白都会被忽略掉
    3.空白行以也将被忽略掉,并且[tab]所产生的空白同样视为空格键
    4.如果读取到一个enter符号(CR),就尝试开始执行改行的命令
    5.至于如果一行的内容太多,则可以使用[\enter]来扩展下一行
    6[#]可作为注释,任何加在#后面的数据将全部被视为注释文字而被忽略
    执行时:
    1.shell.sh文件需要具备可读与可执行的权限.
    2.绝对路径:/home/zcj/shell.sh
    3.相对路径:./shell.sh
    4.变量[PATH]功能:将shell.sh放在PATH指定的目录内,例如: /usr/bin等
    5.以bash程序来执行:通过[bash shell.sh]或[sh shell.sh]来执行

    编写第一个脚本:
    address :~/bin/hello.sh
    1.#!/bin/bash
    声明这个脚本使用的shell名称,因为我们使用bash,所以,一定要以
    [#!/bin/bash]来声明这个文件内使用bash的语法.这样这个程序执行时,它才能
    加载bash的相关环境配置文件(一般是非登陆的shell,所以用~/.bashrc),并且执行
    bash来使我们下面的命令能够执行.
    相当于新打开一个bash,此时其一些环境的变量还需我们的设置.

    2.程序内容的说明:
    除了第一行是用来声明shell除外,其他的#都是注释.建议养成习惯:
    说明该脚本的:1.内容与功能;2.版本信息;3.作者与联系方式;4.建立文件日期;
                 5.历史记录等.


    3.主要环境变量的声明:
    建议务必要将一些重要的环境变量设置好,例如,PATH与LANG是最重要的.如此一来,
    可以执行一些外部命令,而不必写绝对路径.

    4.主要程序部分:
    
    5.执行结果告知:
    我们可以使用$?变量来观察,那么我们也可以利用exit这个命令来让程序终端,并且返回
    一个数值给系统.即exit 0.此时中断程序,并将0返回给系统.


     12.1.3建立shell脚本的良好编写习惯
     1.脚本的功能
     2.脚本的版本信息
     3.脚本的作者与联络方式
     4.脚本的版权声明方式
     5.脚本的Hisroty
     6.脚本内较特殊的命令,使用绝对路径的方式来执行
     7.脚本运行时需要的环境变量预先声明与设置(PATH)
     在包裹内部程序代码最好能以[tab]的空格向后推.


12.2简单的shell的脚本练习
   12.2.1简单范例
   
   1.交互式脚本:变量内容由用户决定
   address:~/bin/showname.sh

   2.随日期变化:利用date建立文件
   address: ~/bin/create_datefile.sh
   当我们要将每一天的数据库的数据备份以下,那么我们就可以用时间参与备份文件的名称.

   3.数值运算:简单的加减乘除
   利用[$((计算式))]来进行数值运算.
   address: ~/bin/multiplying.sh

   4.数值运算:通过bc计算Pi(圆周率)
   address ~/bin/cal_pi.sh
   
     
   12.2.2 脚本的执行方式差异(source ,sh script , ./script)
   .利用直接执行的方式来执行脚本(相对/绝对路径,sh/bash)
   使用这种方式执行时,其实脚本是在子进程bash内执行的.当子进程完成后,在子进程内
   的各项变量或操作将会结束,而不会传到父进程中.

   .利用source来执行脚本:在父进程中执行(此时脚本不建议自己写PATH)



12.3善用判断式:

   12.3.1 利用test命令的测试功能
   我们要检测/mulu 是否存在时,使用
   test -e /mulu,
   结果要用$?来查看

   test是一个好用的工具,自己用man查看;
   
   判断文件的类型与属性:
   address:~/bin/file_perm.sh


   12.3.2利用判断符号[]
   使用方法与test几乎一模一样.
   
   判断字符串是否为空:
   [-z "${HOME}"];echo $?;
   由于通配符和正则表达式都使用中括号,因此,在这里的中括号使用时,两边都是要有空格
   的,无论哪一个.
   .在中括号内的每个组件都需要空格来分开
   .在中括号内的变量,最好都用""括号起来
   .在中括号内的常量,最好都用''/""括号起来

    假设name=abc def;
    那么 [ ${name} == "abc def" ]
    就会报错,因为参数太多了.由于${name}没有双引号括起来,
    此时就会变成 [ abc def == "abc def" ]
    此时就有两个参数了.

    address:　bin
    ans_yn.sh

    
    12.3.3shell 脚本的默认变量（$0,$1,...）
    命令是可以带有选项与参数的，脚本一样也可以．
    脚本是如何完成这个功能的？其实脚本针对参数已经设置了一些变量名称．
    /path/to/script op1 op2 op3 op4
    $0               $1  $2  $3  $4

    执行脚本的文件名为$0这个变量，第一个接的参数时$1.所以我们只要在脚本里面
    善用$1,$2,$3,$4　这些变量，就可以很简单地立即执行某些命令功能．
    此外还有其他的一些较为特殊的变量：
    $#  :代表后接的参数的［个数］，以上表为例，这里显示为4
    $@  :代表［"$1""$2""$3""$4"］之意，每个变量是独立的．
    $*  :代表［"$1c$2c$3c$4"］，其中c为分隔符号，默认是空格，所以本例中代表
    　　　［"$1 $2 $3 $4"］的意思．
    
　　执行下面脚本后，屏幕会显示如下数据：
　　程序的文件名是什么
　　共有几个参数
　　若参数的个数小于2则告知用户参数量太少
　　全部的参数内容是什么
　　第一个参数是什么
　　第二个参数是什么

　　address:how_paras.sh


    shift:造成参数变量号码偏移
    adress :shift_paras.sh
    shift num:可以使变量向前移动，此时$2变为$1．而$1就会被移除．

　　

12.4　条件判断式

   ［if then］:
   
   1.单层，简单条件判断式：
   如果你只有一个判断式要进行：
   if [条件判断式];then
           但条件判断式成立时，可以进行的指令工作内容
   fi

　
   条件判断式：
   但有多个判断条件时，我们有两个写法，第一种：只有一个中括号，如上面所写．
   另一种：有多个中括号，彼此之间使用|| 或　&&　来间隔．
   ["${yn}" == "Y" -o "${yn}" == "y"]
   ["$｛yn}" == "Y" ] || [ "${yn}" == "y"]


   2.多重，复杂的条件判断式：
   if [条件判断式]; then
   elif [条件判断式]; then
   else
   fi
   address:hello-2.sh


   中途插入一些信息：netstat;
   netstat -tunl
   可以得到关于目前主机开启的网络服务端口
   在local address这里列中，127.0.0.1仅对本机开放，
   0.0.0.0 或　:::　对整个Internet　开放

   常见端口与相关网络服务的关系：
   80：www
   22:ssh
   21:ftp
   25:mail
   111:RPC(远程过程调用)
   631:CPUS(打印服务功能)

   address : netstat.sh


   12.4.2 利用case...esac判断
   case $变量名称　in
     "第一个变量内容")
            程序内容
	    ;;
     "第二个变量内容")
            程序内容
	    ;;

     *)
            程序内容
	    ;;

   esac
   注意：开头结尾是case与esac；每一个变量内容的程序段最后都需要两个分号(;;)；
   　　　*变量的用处是类似else,即其他所有的可能性,本质指0－无穷的任意字符，通
   　　　配符．

   address: hello-3.sh


   12.4.3 利用fuction功能
   语法：
   fuction fname(){
   　　程序段
   }
   由于shell script的运行顺序是从上而下，从左到右，因此在shell script当中的
   fuction的设置一定要在程序的最前面，就像ｃ语言，这样才可能被找到．
   address :show123-2.sh

   另外，fuction也是拥有内置变量的，它的内置变量与shell脚本很类似，函数名称
   表示$0,而后续的变量也是以$1,$2...来替换．fuction里面的变量与shell script
   里面的变量不同．


   12.5 循环loop

   12.5.1 while do done ,until do done

   while [ condition ]
   do
      程序段落
   done
   当condition条件成立时，就进行循环，直到条件不成立


   until [condition]
   do
       程序段落
   done
   当condition条件不成立时，就进行循环，直到条件成立


   address : yes_to_stop.sh;cal_1_100.sh



   12.5.3 for...do...done(固定循环)
   相对于while,until;for已经知道要进行几次循环
   for var in con1,con2,con3...
   do
      程序段落
   done

   第一次循环为con1
   第二次循环为con２
   第三次循环为con３
   ．．．

   address : show_animals.sh;userid.sh;pingip.sh;
   seq 1 100 生成1到100的每个整数．

   12.5.4搭配随机数与数组的实验：
   address: what_to_eat.sh;what_to_eat-2.sh
   


   12.6　shell脚本的跟踪与调试
   我们最讨厌的就是shell script的语法错误：
   但是我们可以在不直接执行的情况下，判断脚本是否有问题．
   sh [-nvx] script.sh
   -n :不要执行脚本,仅查询语法的问题
   -v :在执行脚本之前,先将脚本文件的内容输出到屏幕上
   -x :将使用到的脚本内容显示到屏幕上

   -x输出的内容:
   +号后面的数据其实都是命令串,由于sh -x的方式将命令执行过程也显示出来,
   这样用户就可以判断程序代码执行到哪一段时会出现相关的信息.

   